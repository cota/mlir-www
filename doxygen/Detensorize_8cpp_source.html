<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLIR: lib/Dialect/Linalg/Transforms/Detensorize.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MLIR
   &#160;<span id="projectnumber">13.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1a25ec519b6c1121408b67cc33ce3f15.html">Dialect</a></li><li class="navelem"><a class="el" href="dir_8edb792440615361a0811a7329611599.html">Linalg</a></li><li class="navelem"><a class="el" href="dir_7e2f808e77498894ca0efbd745da2201.html">Transforms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Detensorize.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Detensorize_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- Detensorize.cpp - Linalg transformations as patterns ----------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h.html">PassDetail.h</a>&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LinalgOps_8h.html">mlir/Dialect/Linalg/IR/LinalgOps.h</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LinalgTypes_8h.html">mlir/Dialect/Linalg/IR/LinalgTypes.h</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dialect_2Linalg_2Passes_8h.html">mlir/Dialect/Linalg/Passes.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="FuncConversions_8h.html">mlir/Dialect/StandardOps/Transforms/FuncConversions.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dialect_2Tensor_2IR_2Tensor_8h.html">mlir/Dialect/Tensor/IR/Tensor.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OpDefinition_8h.html">mlir/IR/OpDefinition.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DialectConversion_8h.html">mlir/Transforms/DialectConversion.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GreedyPatternRewriteDriver_8h.html">mlir/Transforms/GreedyPatternRewriteDriver.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacemlir.html">mlir</a>;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacemlir_1_1linalg.html">mlir::linalg</a>;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="Detensorize_8cpp.html#aa8d17596c6b867611e99d2e4badb374c">   24</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classmlir_1_1Value.html">Value</a> <a class="code" href="Detensorize_8cpp.html#aa8d17596c6b867611e99d2e4badb374c">sourceMaterializationCallback</a>(<a class="code" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;builder, <a class="code" href="classmlir_1_1Type.html">Type</a> type,</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                                           <a class="code" href="classmlir_1_1ValueRange.html">ValueRange</a> inputs, <a class="code" href="classmlir_1_1Location.html">Location</a> loc) {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  assert(inputs.size() == 1);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">// A detensored value is converted back by creating a new tensor from its</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">// element(s).</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keyword">auto</span> createNewTensorOp = builder.<a class="code" href="classmlir_1_1OpBuilder.html#ad694ebfcfd9e3398ccb50fc04969615a">create</a>&lt;tensor::FromElementsOp&gt;(</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      loc, inputs[0].<a class="code" href="classmlir_1_1ValueRange.html#af6f69a054839cbb2331521ea841fe4c4">getType</a>(), inputs[0]);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="comment">// FromElementsOp results in a tensor&lt;1xdtype&gt;, we need to reshape that to</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">// a tensor&lt;dtype&gt; instead.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">return</span> builder.<a class="code" href="classmlir_1_1OpBuilder.html#ad694ebfcfd9e3398ccb50fc04969615a">create</a>&lt;linalg::TensorReshapeOp&gt;(</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      loc, type, createNewTensorOp, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;ReassociationExprs&gt;</a>{});</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/// Defines the criteria a TensorType must follow in order to be considered</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/// &quot;detensorable&quot;.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/// NOTE: For now, only 0-D are supported.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/// Returns true if tensorType can be detensored.</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> canBeDetensored(<a class="code" href="classmlir_1_1TensorType.html">TensorType</a> tensorType) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">return</span> tensorType.<a class="code" href="classmlir_1_1ShapedType.html#ae9dc5285e8a811588d611a52c2fa2fa7">hasRank</a>() &amp;&amp; tensorType.<a class="code" href="classmlir_1_1ShapedType.html#a986cf9d0f91fefd448ebed5cb2a46745">getRank</a>() == 0;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">/// A conversion patttern for detensoring `linalg.generic` ops.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span><span class="keyword">class </span>DetensorizeGenericOp : <span class="keyword">public</span> <a class="code" href="structmlir_1_1OpConversionPattern.html">OpConversionPattern</a>&lt;GenericOp&gt; {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">using</span> <a class="code" href="structmlir_1_1OpConversionPattern.html#a70e9bba2dedbc2c58a13a09ee9016227">OpConversionPattern::OpConversionPattern</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  matchAndRewrite(GenericOp op, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value&gt;</a> operands,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                  <a class="code" href="classmlir_1_1ConversionPatternRewriter.html">ConversionPatternRewriter</a> &amp;rewriter)<span class="keyword"> const override </span>{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="classmlir_1_1Block.html">Block</a> *originalBlock = op-&gt;getBlock();</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Gather some information about the op before inling its region.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="classmlir_1_1Block.html">Block</a> *opEntryBlock = &amp;*op.region().<a class="code" href="classmlir_1_1Block.html#aae2dc2f0bf00a23306aba81178b06631">begin</a>();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    YieldOp yieldOp = dyn_cast&lt;YieldOp&gt;(op.region().back().getTerminator());</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Split the op&#39;s region before the op. This way, we have a clear insertion</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// point in which the op can be inlined.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="classmlir_1_1Block.html">Block</a> *newBlock = originalBlock-&gt;<a class="code" href="classmlir_1_1Block.html#a3f9cef382c6df9c30afceef254e5c1a5">splitBlock</a>(op);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a47becd4896180e2132b82f7d9071d0a9">inlineRegionBefore</a>(op.region(), newBlock);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// Now that op&#39;s region is inlined, the operands of its YieldOp are mapped</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// to the materialized target values. Therefore, we can replace the op&#39;s</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// uses with those of its YielOp&#39;s operands.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a12fa2633cd26e201bb171204cc1d313b">replaceOp</a>(op, yieldOp-&gt;getOperands());</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// No need for these intermediate blocks, merge them into 1.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a806a523a4db1d2b056855cc6cfd58c18">mergeBlocks</a>(opEntryBlock, originalBlock, operands);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a806a523a4db1d2b056855cc6cfd58c18">mergeBlocks</a>(newBlock, originalBlock, {});</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a56f841ea5c2326350a6d7182e9028a0e">eraseOp</a>(&amp;*<a class="code" href="classmlir_1_1Block.html#a0ea87a88ccca470d216809e2a162d909">Block::iterator</a>(yieldOp));</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;};</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">/// A conversion pattern for detensoring internal (non-entry) blocks within a</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">/// function.</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span><span class="keyword">struct </span>FunctionNonEntryBlockConversion : <span class="keyword">public</span> <a class="code" href="classmlir_1_1ConversionPattern.html">ConversionPattern</a> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  FunctionNonEntryBlockConversion(StringRef functionLikeOpName,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                  <a class="code" href="classmlir_1_1MLIRContext.html">MLIRContext</a> *ctx, <a class="code" href="classmlir_1_1TypeConverter.html">TypeConverter</a> &amp;converter)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      : <a class="code" href="classmlir_1_1ConversionPattern.html">ConversionPattern</a>(converter, functionLikeOpName, <span class="comment">/*benefit=*/</span>1, ctx) {}</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  matchAndRewrite(<a class="code" href="classmlir_1_1Operation.html">Operation</a> *op, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value&gt;</a> operands,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                  <a class="code" href="classmlir_1_1ConversionPatternRewriter.html">ConversionPatternRewriter</a> &amp;rewriter)<span class="keyword"> const override </span>{</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#ae93d2750ab20628c2b4d5d00ce8a283e">startRootUpdate</a>(op);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a9e1921b68c1d495283d400ca68179a59">convertNonEntryRegionTypes</a>(</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            &amp;<a class="code" href="namespacemlir_1_1impl.html#a2d0b955dd255295a5acbab266dd68e6b">mlir::impl::getFunctionBody</a>(op), *typeConverter))) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#aa5ec71d27d9b622e5ff8205c3546701c">cancelRootUpdate</a>(op);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    rewriter.<a class="code" href="classmlir_1_1ConversionPatternRewriter.html#a490be68aa183cbad7ed69f98d0dcc341">finalizeRootUpdate</a>(op);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;};</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">class </span>DetensorizeTypeConverter : <span class="keyword">public</span> <a class="code" href="classmlir_1_1TypeConverter.html">TypeConverter</a> {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  DetensorizeTypeConverter() {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    addConversion([](<a class="code" href="classmlir_1_1Type.html">Type</a> type) { <span class="keywordflow">return</span> type; });</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// A TensorType that can be detensored, is converted to the underlying</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// element type.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    addConversion([](<a class="code" href="classmlir_1_1TensorType.html">TensorType</a> tensorType) -&gt; <a class="code" href="classmlir_1_1Type.html">Type</a> {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordflow">if</span> (canBeDetensored(tensorType))</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">return</span> tensorType.<a class="code" href="classmlir_1_1ShapedType.html#a91b9a54ae8d640e3425c469c2de11c85">getElementType</a>();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">return</span> tensorType;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    });</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// A tensor value is detensoried by extracting its element(s).</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    addTargetMaterialization([](<a class="code" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;builder, <a class="code" href="classmlir_1_1Type.html">Type</a> type,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                <a class="code" href="classmlir_1_1ValueRange.html">ValueRange</a> inputs, <a class="code" href="classmlir_1_1Location.html">Location</a> loc) -&gt; <a class="code" href="classmlir_1_1Value.html">Value</a> {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">return</span> builder.<a class="code" href="classmlir_1_1OpBuilder.html#ad694ebfcfd9e3398ccb50fc04969615a">create</a>&lt;tensor::ExtractOp&gt;(loc, inputs[0], <a class="code" href="classmlir_1_1ValueRange.html">ValueRange</a>{});</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    });</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    addSourceMaterialization(<a class="code" href="Detensorize_8cpp.html#aa8d17596c6b867611e99d2e4badb374c">sourceMaterializationCallback</a>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    addArgumentMaterialization(<a class="code" href="Detensorize_8cpp.html#aa8d17596c6b867611e99d2e4badb374c">sourceMaterializationCallback</a>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;};</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">/// Canonicalizes the pattern of the form</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">/// %tensor = tensor.from_elements(%element) : (i32) -&gt; tensor&lt;1xi32&gt;</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">/// %reshaped_tensor = linalg.tensor_reshape %tensor [] : tensor&lt;1xi32&gt; into</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">///   tensor&lt;i32&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/// %extracted_element = tensor.extract %reshaped_tensor[] : tensor&lt;i32&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/// to just %element.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ExtractFromReshapeFromElements</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    : <span class="keyword">public</span> <a class="code" href="structmlir_1_1OpRewritePattern.html">OpRewritePattern</a>&lt;tensor::ExtractOp&gt; {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keyword">using</span> <a class="code" href="structmlir_1_1OpRewritePattern.html">OpRewritePattern&lt;tensor::ExtractOp&gt;::OpRewritePattern</a>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> matchAndRewrite(tensor::ExtractOp extract,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                <a class="code" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter) <span class="keyword">const</span> <span class="keyword">final</span> {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (extract.indices().size() != 0)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">auto</span> tensorReshape = extract.tensor().getDefiningOp&lt;TensorReshapeOp&gt;();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (tensorReshape == <span class="keyword">nullptr</span>)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">auto</span> tensorFromElements =</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        tensorReshape.getOperand()</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            .getDefiningOp&lt;mlir::tensor::FromElementsOp&gt;();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (tensorFromElements == <span class="keyword">nullptr</span>)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    rewriter.<a class="code" href="classmlir_1_1RewriterBase.html#a53c88f3ce889be590b3801b4ddee627f">replaceOp</a>(extract, tensorFromElements.getOperand(0));</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;};</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/// @see LinalgDetensorize in Linalg/Passes.td for more details.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"></span><span class="keyword">struct </span>LinalgDetensorize : <span class="keyword">public</span> LinalgDetensorizeBase&lt;LinalgDetensorize&gt; {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">void</span> runOnFunction()<span class="keyword"> override </span>{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keyword">auto</span> *context = &amp;getContext();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    DetensorizeTypeConverter typeConverter;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="classmlir_1_1RewritePatternSet.html">RewritePatternSet</a> patterns(context);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="classmlir_1_1ConversionTarget.html">ConversionTarget</a> target(*context);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    target.<a class="code" href="classmlir_1_1ConversionTarget.html#aa4d9a913697c243567606d15880c4b76">addDynamicallyLegalOp</a>&lt;GenericOp&gt;([&amp;](GenericOp op) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="comment">// If any of the operands or results cannot be detensored (i.e. they are</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="comment">// all legal according the DetensorizeTypeConverter), the op is considered</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="comment">// legal and won&#39;t be detensored.</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">return</span> llvm::any_of(op.getShapedOperandTypes(),</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                          [&amp;](<a class="code" href="classmlir_1_1ShapedType.html">ShapedType</a> shapedType) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                            <span class="keywordflow">return</span> typeConverter.isLegal(shapedType);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                          });</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    });</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    target.<a class="code" href="classmlir_1_1ConversionTarget.html#aa4d9a913697c243567606d15880c4b76">addDynamicallyLegalOp</a>&lt;FuncOp&gt;([&amp;](FuncOp op) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="comment">// A function is legal if all of its non-entry blocks are legal. We don&#39;t</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="comment">// legalize the entry block (i.e. the function&#39;s signature) since</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="comment">// detensoring can&#39;t happen along external calling convention boundaries,</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="comment">// which we conservatively approximate as all function signatures.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">return</span> llvm::all_of(llvm::drop_begin(op.getBody(), 1), [&amp;](<a class="code" href="classmlir_1_1Block.html">Block</a> &amp;block) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span> typeConverter.isLegal(block.<a class="code" href="classmlir_1_1Block.html#a1809770ce68f483cee49150e3e27ade2">getArgumentTypes</a>());</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      });</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    });</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    target.<a class="code" href="classmlir_1_1ConversionTarget.html#a603afb54d13b27dee0cefe78cbf78319">markUnknownOpDynamicallyLegal</a>([&amp;](<a class="code" href="classmlir_1_1Operation.html">Operation</a> *op) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a625259a35e521a9f6d7b7fe115423e87">isNotBranchOpInterfaceOrReturnLikeOp</a>(op) ||</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;             <a class="code" href="namespacemlir.html#af233cbc2b6252b0f87bbc95f2bc8c553">isLegalForBranchOpInterfaceTypeConversionPattern</a>(op,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                                              typeConverter) ||</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;             <a class="code" href="namespacemlir.html#ab6b78043105c4babf3635efc8a0c5db1">isLegalForReturnOpTypeConversionPattern</a>(</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                 op, typeConverter, <span class="comment">/*returnOpAlwaysLegal*/</span> <span class="keyword">true</span>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    });</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    patterns.<a class="code" href="classmlir_1_1RewritePatternSet.html#a505369d9b77a376d06218309fd2a7431">add</a>&lt;DetensorizeGenericOp&gt;(typeConverter, context);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    patterns.<a class="code" href="classmlir_1_1RewritePatternSet.html#a505369d9b77a376d06218309fd2a7431">add</a>&lt;FunctionNonEntryBlockConversion&gt;(FuncOp::getOperationName(),</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                                  context, typeConverter);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// Since non-entry block arguments get detensorized, we also need to update</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// the control flow inside the function to reflect the correct types.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="namespacemlir.html#aa02d9333c7f6bc7b7569e8edb7d84527">populateBranchOpInterfaceTypeConversionPattern</a>(patterns, typeConverter);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(<a class="code" href="namespacemlir.html#acb362d368fe137a8d095c1255a95922e">applyFullConversion</a>(getFunction(), target, std::move(patterns))))</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      signalPassFailure();</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="classmlir_1_1RewritePatternSet.html">RewritePatternSet</a> canonPatterns(context);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    canonPatterns.<a class="code" href="classmlir_1_1RewritePatternSet.html#a505369d9b77a376d06218309fd2a7431">add</a>&lt;ExtractFromReshapeFromElements&gt;(context);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(<a class="code" href="namespacemlir.html#a4fd4d1e22050420db811331302a0038e">applyPatternsAndFoldGreedily</a>(getFunction(),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                            std::move(canonPatterns))))</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      signalPassFailure();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;};</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;} <span class="comment">// namespace</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="namespacemlir.html#a888e0ad22e8609a0c5042ccecdb7adc7">  216</a></span>&#160;std::unique_ptr&lt;Pass&gt; <a class="code" href="namespacemlir.html#a888e0ad22e8609a0c5042ccecdb7adc7">mlir::createLinalgDetensorizePass</a>() {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">return</span> std::make_unique&lt;LinalgDetensorize&gt;();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="ttc" id="namespacemlir_html"><div class="ttname"><a href="namespacemlir.html">mlir</a></div><div class="ttdoc">Include the generated interface declarations. </div><div class="ttdef"><b>Definition:</b> <a href="AffineAnalysis_8h_source.html#l00022">AffineAnalysis.h:22</a></div></div>
<div class="ttc" id="Dialect_2Linalg_2Passes_8h_html"><div class="ttname"><a href="Dialect_2Linalg_2Passes_8h.html">Passes.h</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html_aae2dc2f0bf00a23306aba81178b06631"><div class="ttname"><a href="classmlir_1_1Block.html#aae2dc2f0bf00a23306aba81178b06631">mlir::Block::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Block_8h_source.html#l00131">Block.h:131</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionTarget_html_aa4d9a913697c243567606d15880c4b76"><div class="ttname"><a href="classmlir_1_1ConversionTarget.html#aa4d9a913697c243567606d15880c4b76">mlir::ConversionTarget::addDynamicallyLegalOp</a></div><div class="ttdeci">void addDynamicallyLegalOp()</div><div class="ttdoc">Register the given operation as dynamically legal, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00648">DialectConversion.h:648</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionTarget_html_a603afb54d13b27dee0cefe78cbf78319"><div class="ttname"><a href="classmlir_1_1ConversionTarget.html#a603afb54d13b27dee0cefe78cbf78319">mlir::ConversionTarget::markUnknownOpDynamicallyLegal</a></div><div class="ttdeci">void markUnknownOpDynamicallyLegal(const DynamicLegalityCallbackFn &amp;fn)</div><div class="ttdoc">Register unknown operations as dynamically legal. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00755">DialectConversion.h:755</a></div></div>
<div class="ttc" id="DialectConversion_8h_html"><div class="ttname"><a href="DialectConversion_8h.html">DialectConversion.h</a></div></div>
<div class="ttc" id="classmlir_1_1PatternRewriter_html"><div class="ttname"><a href="classmlir_1_1PatternRewriter.html">mlir::PatternRewriter</a></div><div class="ttdoc">A special type of RewriterBase that coordinates the application of a rewrite pattern on the current I...</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00811">PatternMatch.h:811</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html"><div class="ttname"><a href="classmlir_1_1Operation.html">mlir::Operation</a></div><div class="ttdoc">Operation is a basic unit of execution within MLIR. </div><div class="ttdef"><b>Definition:</b> <a href="Operation_8h_source.html#l00028">Operation.h:28</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html"><div class="ttname"><a href="classmlir_1_1Block.html">mlir::Block</a></div><div class="ttdoc">Block represents an ordered list of Operations. </div><div class="ttdef"><b>Definition:</b> <a href="Block_8h_source.html#l00028">Block.h:28</a></div></div>
<div class="ttc" id="classmlir_1_1ShapedType_html_a986cf9d0f91fefd448ebed5cb2a46745"><div class="ttname"><a href="classmlir_1_1ShapedType.html#a986cf9d0f91fefd448ebed5cb2a46745">mlir::ShapedType::getRank</a></div><div class="ttdeci">int64_t getRank() const</div><div class="ttdoc">If this is a ranked type, return the rank. Otherwise, abort. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2BuiltinTypes_8cpp_source.html#l00316">BuiltinTypes.cpp:316</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPattern_html"><div class="ttname"><a href="classmlir_1_1ConversionPattern.html">mlir::ConversionPattern</a></div><div class="ttdoc">Base class for the conversion patterns. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00313">DialectConversion.h:313</a></div></div>
<div class="ttc" id="namespacemlir_html_aeec13ab4fb753865cdfd2699aa01c23b"><div class="ttname"><a href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">mlir::failed</a></div><div class="ttdeci">bool failed(LogicalResult result)</div><div class="ttdoc">Utility function that returns true if the provided LogicalResult corresponds to a failure value...</div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00072">LogicalResult.h:72</a></div></div>
<div class="ttc" id="Dialect_2Tensor_2IR_2Tensor_8h_html"><div class="ttname"><a href="Dialect_2Tensor_2IR_2Tensor_8h.html">Tensor.h</a></div></div>
<div class="ttc" id="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h_html"><div class="ttname"><a href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h.html">PassDetail.h</a></div></div>
<div class="ttc" id="LinalgTypes_8h_html"><div class="ttname"><a href="LinalgTypes_8h.html">LinalgTypes.h</a></div></div>
<div class="ttc" id="namespacemlir_html_ab6b78043105c4babf3635efc8a0c5db1"><div class="ttname"><a href="namespacemlir.html#ab6b78043105c4babf3635efc8a0c5db1">mlir::isLegalForReturnOpTypeConversionPattern</a></div><div class="ttdeci">bool isLegalForReturnOpTypeConversionPattern(Operation *op, TypeConverter &amp;converter, bool returnOpAlwaysLegal=false)</div><div class="ttdoc">For ReturnLike ops (except return), return True. </div><div class="ttdef"><b>Definition:</b> <a href="FuncConversions_8cpp_source.html#l00127">FuncConversions.cpp:127</a></div></div>
<div class="ttc" id="structmlir_1_1OpConversionPattern_html"><div class="ttname"><a href="structmlir_1_1OpConversionPattern.html">mlir::OpConversionPattern</a></div><div class="ttdoc">OpConversionPattern is a wrapper around ConversionPattern that allows for matching and rewriting agai...</div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00416">DialectConversion.h:416</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a12fa2633cd26e201bb171204cc1d313b"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a12fa2633cd26e201bb171204cc1d313b">mlir::ConversionPatternRewriter::replaceOp</a></div><div class="ttdeci">void replaceOp(Operation *op, ValueRange newValues) override</div><div class="ttdoc">PatternRewriter hook for replacing the results of an operation. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01307">DialectConversion.cpp:1307</a></div></div>
<div class="ttc" id="classmlir_1_1ShapedType_html"><div class="ttname"><a href="classmlir_1_1ShapedType.html">mlir::ShapedType</a></div><div class="ttdoc">This is a common base class between Vector, UnrankedTensor, RankedTensor, and MemRef types because th...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2BuiltinTypes_8h_source.html#l00066">BuiltinTypes.h:66</a></div></div>
<div class="ttc" id="classmlir_1_1Location_html"><div class="ttname"><a href="classmlir_1_1Location.html">mlir::Location</a></div><div class="ttdoc">This class defines the main interface for locations in MLIR and acts as a non-nullable wrapper around...</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00044">Location.h:44</a></div></div>
<div class="ttc" id="namespacemlir_html_acb362d368fe137a8d095c1255a95922e"><div class="ttname"><a href="namespacemlir.html#acb362d368fe137a8d095c1255a95922e">mlir::applyFullConversion</a></div><div class="ttdeci">LogicalResult applyFullConversion(ArrayRef&lt; Operation *&gt; ops, ConversionTarget &amp;target, const FrozenRewritePatternSet &amp;patterns)</div><div class="ttdoc">Apply a complete conversion on the given operations, and all nested operations. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l02792">DialectConversion.cpp:2792</a></div></div>
<div class="ttc" id="namespacemlir_html_a5f55c06c7c4aeace3f6824dd68f8b1ed"><div class="ttname"><a href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">mlir::success</a></div><div class="ttdeci">LogicalResult success(bool isSuccess=true)</div><div class="ttdoc">Utility function to generate a LogicalResult. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00056">LogicalResult.h:56</a></div></div>
<div class="ttc" id="structmlir_1_1LogicalResult_html"><div class="ttname"><a href="structmlir_1_1LogicalResult.html">mlir::LogicalResult</a></div><div class="ttdoc">This class represents an efficient way to signal success or failure. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00026">LogicalResult.h:26</a></div></div>
<div class="ttc" id="namespacemlir_html_a07367c8c4a3d4a47a32bc2b9b7d8a3f4"><div class="ttname"><a href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">mlir::failure</a></div><div class="ttdeci">LogicalResult failure(bool isFailure=true)</div><div class="ttdoc">Utility function to generate a LogicalResult. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00062">LogicalResult.h:62</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00043">LLVM.h:43</a></div></div>
<div class="ttc" id="classmlir_1_1RewriterBase_html_a53c88f3ce889be590b3801b4ddee627f"><div class="ttname"><a href="classmlir_1_1RewriterBase.html#a53c88f3ce889be590b3801b4ddee627f">mlir::RewriterBase::replaceOp</a></div><div class="ttdeci">virtual void replaceOp(Operation *op, ValueRange newValues)</div><div class="ttdoc">This method replaces the results of the operation with the specified list of values. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8cpp_source.html#l00221">PatternMatch.cpp:221</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html_a0ea87a88ccca470d216809e2a162d909"><div class="ttname"><a href="classmlir_1_1Block.html#a0ea87a88ccca470d216809e2a162d909">mlir::Block::iterator</a></div><div class="ttdeci">OpListType::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="Block_8h_source.html#l00128">Block.h:128</a></div></div>
<div class="ttc" id="classmlir_1_1OpBuilder_html_ad694ebfcfd9e3398ccb50fc04969615a"><div class="ttname"><a href="classmlir_1_1OpBuilder.html#ad694ebfcfd9e3398ccb50fc04969615a">mlir::OpBuilder::create</a></div><div class="ttdeci">OpTy create(Location location, Args &amp;&amp;... args)</div><div class="ttdoc">Create an operation of specific op type at the current insertion point. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2Builders_8h_source.html#l00392">Builders.h:392</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a806a523a4db1d2b056855cc6cfd58c18"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a806a523a4db1d2b056855cc6cfd58c18">mlir::ConversionPatternRewriter::mergeBlocks</a></div><div class="ttdeci">void mergeBlocks(Block *source, Block *dest, ValueRange argValues) override</div><div class="ttdoc">PatternRewriter hook for merging a block into another. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01390">DialectConversion.cpp:1390</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_ae93d2750ab20628c2b4d5d00ce8a283e"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#ae93d2750ab20628c2b4d5d00ce8a283e">mlir::ConversionPatternRewriter::startRootUpdate</a></div><div class="ttdeci">void startRootUpdate(Operation *op) override</div><div class="ttdoc">PatternRewriter hook for updating the root operation in-place. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01436">DialectConversion.cpp:1436</a></div></div>
<div class="ttc" id="LinalgOps_8h_html"><div class="ttname"><a href="LinalgOps_8h.html">LinalgOps.h</a></div></div>
<div class="ttc" id="namespacemlir_1_1linalg_html"><div class="ttname"><a href="namespacemlir_1_1linalg.html">mlir::linalg</a></div><div class="ttdef"><b>Definition:</b> <a href="LinalgToStandard_8h_source.html#l00020">LinalgToStandard.h:20</a></div></div>
<div class="ttc" id="GreedyPatternRewriteDriver_8h_html"><div class="ttname"><a href="GreedyPatternRewriteDriver_8h.html">GreedyPatternRewriteDriver.h</a></div></div>
<div class="ttc" id="classmlir_1_1TensorType_html"><div class="ttname"><a href="classmlir_1_1TensorType.html">mlir::TensorType</a></div><div class="ttdoc">Tensor types represent multi-dimensional arrays, and have two variants: RankedTensorType and Unranked...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2BuiltinTypes_8h_source.html#l00152">BuiltinTypes.h:152</a></div></div>
<div class="ttc" id="classmlir_1_1RewritePatternSet_html"><div class="ttname"><a href="classmlir_1_1RewritePatternSet.html">mlir::RewritePatternSet</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00820">PatternMatch.h:820</a></div></div>
<div class="ttc" id="classmlir_1_1ValueRange_html_af6f69a054839cbb2331521ea841fe4c4"><div class="ttname"><a href="classmlir_1_1ValueRange.html#af6f69a054839cbb2331521ea841fe4c4">mlir::ValueRange::getType</a></div><div class="ttdeci">auto getType() const</div><div class="ttdef"><b>Definition:</b> <a href="OperationSupport_8h_source.html#l00825">OperationSupport.h:825</a></div></div>
<div class="ttc" id="namespacemlir_html_aa02d9333c7f6bc7b7569e8edb7d84527"><div class="ttname"><a href="namespacemlir.html#aa02d9333c7f6bc7b7569e8edb7d84527">mlir::populateBranchOpInterfaceTypeConversionPattern</a></div><div class="ttdeci">void populateBranchOpInterfaceTypeConversionPattern(RewritePatternSet &amp;patterns, TypeConverter &amp;converter)</div><div class="ttdoc">Add a pattern to the given pattern list to rewrite branch operations to use operands that have been l...</div><div class="ttdef"><b>Definition:</b> <a href="FuncConversions_8cpp_source.html#l00100">FuncConversions.cpp:100</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a47becd4896180e2132b82f7d9071d0a9"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a47becd4896180e2132b82f7d9071d0a9">mlir::ConversionPatternRewriter::inlineRegionBefore</a></div><div class="ttdeci">void inlineRegionBefore(Region &amp;region, Region &amp;parent, Region::iterator before) override</div><div class="ttdoc">PatternRewriter hook for moving blocks out of a region. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01405">DialectConversion.cpp:1405</a></div></div>
<div class="ttc" id="classmlir_1_1ShapedType_html_ae9dc5285e8a811588d611a52c2fa2fa7"><div class="ttname"><a href="classmlir_1_1ShapedType.html#ae9dc5285e8a811588d611a52c2fa2fa7">mlir::ShapedType::hasRank</a></div><div class="ttdeci">bool hasRank() const</div><div class="ttdoc">Whether or not this is a ranked type. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2BuiltinTypes_8cpp_source.html#l00321">BuiltinTypes.cpp:321</a></div></div>
<div class="ttc" id="classmlir_1_1Type_html"><div class="ttname"><a href="classmlir_1_1Type.html">mlir::Type</a></div><div class="ttdoc">Instances of the Type class are uniqued, have an immutable identifier and an optional mutable compone...</div><div class="ttdef"><b>Definition:</b> <a href="Types_8h_source.html#l00072">Types.h:72</a></div></div>
<div class="ttc" id="namespacemlir_html_af233cbc2b6252b0f87bbc95f2bc8c553"><div class="ttname"><a href="namespacemlir.html#af233cbc2b6252b0f87bbc95f2bc8c553">mlir::isLegalForBranchOpInterfaceTypeConversionPattern</a></div><div class="ttdeci">bool isLegalForBranchOpInterfaceTypeConversionPattern(Operation *op, TypeConverter &amp;converter)</div><div class="ttdoc">Return true if op is a BranchOpInterface op whose operands are all legal according to converter...</div><div class="ttdef"><b>Definition:</b> <a href="FuncConversions_8cpp_source.html#l00106">FuncConversions.cpp:106</a></div></div>
<div class="ttc" id="OpDefinition_8h_html"><div class="ttname"><a href="OpDefinition_8h.html">OpDefinition.h</a></div></div>
<div class="ttc" id="classmlir_1_1Value_html"><div class="ttname"><a href="classmlir_1_1Value.html">mlir::Value</a></div><div class="ttdoc">This class represents an instance of an SSA value in the MLIR system, representing a computable value...</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00082">Value.h:82</a></div></div>
<div class="ttc" id="classmlir_1_1ShapedType_html_a91b9a54ae8d640e3425c469c2de11c85"><div class="ttname"><a href="classmlir_1_1ShapedType.html#a91b9a54ae8d640e3425c469c2de11c85">mlir::ShapedType::getElementType</a></div><div class="ttdeci">Type getElementType() const</div><div class="ttdoc">Return the element type. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2BuiltinTypes_8cpp_source.html#l00295">BuiltinTypes.cpp:295</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html_a1809770ce68f483cee49150e3e27ade2"><div class="ttname"><a href="classmlir_1_1Block.html#a1809770ce68f483cee49150e3e27ade2">mlir::Block::getArgumentTypes</a></div><div class="ttdeci">ValueTypeRange&lt; BlockArgListType &gt; getArgumentTypes()</div><div class="ttdoc">Return a range containing the types of the arguments for this block. </div><div class="ttdef"><b>Definition:</b> <a href="Block_8cpp_source.html#l00137">Block.cpp:137</a></div></div>
<div class="ttc" id="structmlir_1_1OpRewritePattern_html"><div class="ttname"><a href="structmlir_1_1OpRewritePattern.html">mlir::OpRewritePattern</a></div><div class="ttdoc">OpRewritePattern is a wrapper around RewritePattern that allows for matching and rewriting against an...</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00298">PatternMatch.h:298</a></div></div>
<div class="ttc" id="structmlir_1_1OpConversionPattern_html_a70e9bba2dedbc2c58a13a09ee9016227"><div class="ttname"><a href="structmlir_1_1OpConversionPattern.html#a70e9bba2dedbc2c58a13a09ee9016227">mlir::OpConversionPattern::OpConversionPattern</a></div><div class="ttdeci">OpConversionPattern(MLIRContext *context, PatternBenefit benefit=1)</div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00418">DialectConversion.h:418</a></div></div>
<div class="ttc" id="namespacemlir_html_a625259a35e521a9f6d7b7fe115423e87"><div class="ttname"><a href="namespacemlir.html#a625259a35e521a9f6d7b7fe115423e87">mlir::isNotBranchOpInterfaceOrReturnLikeOp</a></div><div class="ttdeci">bool isNotBranchOpInterfaceOrReturnLikeOp(Operation *op)</div><div class="ttdoc">Return true if op is neither BranchOpInterface nor ReturnLike. </div><div class="ttdef"><b>Definition:</b> <a href="FuncConversions_8cpp_source.html#l00144">FuncConversions.cpp:144</a></div></div>
<div class="ttc" id="classmlir_1_1RewritePatternSet_html_a505369d9b77a376d06218309fd2a7431"><div class="ttname"><a href="classmlir_1_1RewritePatternSet.html#a505369d9b77a376d06218309fd2a7431">mlir::RewritePatternSet::add</a></div><div class="ttdeci">RewritePatternSet &amp; add(ConstructorArg &amp;&amp;arg, ConstructorArgs &amp;&amp;... args)</div><div class="ttdoc">Add an instance of each of the pattern types &amp;#39;Ts&amp;#39; to the pattern list with the given arguments...</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00860">PatternMatch.h:860</a></div></div>
<div class="ttc" id="FuncConversions_8h_html"><div class="ttname"><a href="FuncConversions_8h.html">FuncConversions.h</a></div></div>
<div class="ttc" id="classmlir_1_1TypeConverter_html"><div class="ttname"><a href="classmlir_1_1TypeConverter.html">mlir::TypeConverter</a></div><div class="ttdoc">Type conversion class. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00037">DialectConversion.h:37</a></div></div>
<div class="ttc" id="classmlir_1_1MLIRContext_html"><div class="ttname"><a href="classmlir_1_1MLIRContext.html">mlir::MLIRContext</a></div><div class="ttdoc">MLIRContext is the top-level object for a collection of MLIR operations. </div><div class="ttdef"><b>Definition:</b> <a href="MLIRContext_8h_source.html#l00037">MLIRContext.h:37</a></div></div>
<div class="ttc" id="Detensorize_8cpp_html_aa8d17596c6b867611e99d2e4badb374c"><div class="ttname"><a href="Detensorize_8cpp.html#aa8d17596c6b867611e99d2e4badb374c">sourceMaterializationCallback</a></div><div class="ttdeci">static Value sourceMaterializationCallback(OpBuilder &amp;builder, Type type, ValueRange inputs, Location loc)</div><div class="ttdef"><b>Definition:</b> <a href="Detensorize_8cpp_source.html#l00024">Detensorize.cpp:24</a></div></div>
<div class="ttc" id="namespacemlir_html_a4fd4d1e22050420db811331302a0038e"><div class="ttname"><a href="namespacemlir.html#a4fd4d1e22050420db811331302a0038e">mlir::applyPatternsAndFoldGreedily</a></div><div class="ttdeci">LogicalResult applyPatternsAndFoldGreedily(Operation *op, const FrozenRewritePatternSet &amp;patterns)</div><div class="ttdoc">Rewrite the regions of the specified operation, which must be isolated from above, by repeatedly applying the highest benefit patterns in a greedy work-list driven manner. </div><div class="ttdef"><b>Definition:</b> <a href="GreedyPatternRewriteDriver_8cpp_source.html#l00219">GreedyPatternRewriteDriver.cpp:219</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html">mlir::ConversionPatternRewriter</a></div><div class="ttdoc">This class implements a pattern rewriter for use with ConversionPatterns. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00474">DialectConversion.h:474</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a56f841ea5c2326350a6d7182e9028a0e"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a56f841ea5c2326350a6d7182e9028a0e">mlir::ConversionPatternRewriter::eraseOp</a></div><div class="ttdeci">void eraseOp(Operation *op) override</div><div class="ttdoc">PatternRewriter hook for erasing a dead operation. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01318">DialectConversion.cpp:1318</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a490be68aa183cbad7ed69f98d0dcc341"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a490be68aa183cbad7ed69f98d0dcc341">mlir::ConversionPatternRewriter::finalizeRootUpdate</a></div><div class="ttdeci">void finalizeRootUpdate(Operation *op) override</div><div class="ttdoc">PatternRewriter hook for updating the root operation in-place. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01444">DialectConversion.cpp:1444</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionTarget_html"><div class="ttname"><a href="classmlir_1_1ConversionTarget.html">mlir::ConversionTarget</a></div><div class="ttdoc">This class describes a specific conversion target. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8h_source.html#l00590">DialectConversion.h:590</a></div></div>
<div class="ttc" id="namespacemlir_html_a888e0ad22e8609a0c5042ccecdb7adc7"><div class="ttname"><a href="namespacemlir.html#a888e0ad22e8609a0c5042ccecdb7adc7">mlir::createLinalgDetensorizePass</a></div><div class="ttdeci">std::unique_ptr&lt; Pass &gt; createLinalgDetensorizePass()</div><div class="ttdoc">Create a pass to convert Linalg operations to equivalent operations that work on primitive types...</div><div class="ttdef"><b>Definition:</b> <a href="Detensorize_8cpp_source.html#l00216">Detensorize.cpp:216</a></div></div>
<div class="ttc" id="namespacemlir_1_1impl_html_a2d0b955dd255295a5acbab266dd68e6b"><div class="ttname"><a href="namespacemlir_1_1impl.html#a2d0b955dd255295a5acbab266dd68e6b">mlir::impl::getFunctionBody</a></div><div class="ttdeci">Region &amp; getFunctionBody(Operation *op)</div><div class="ttdoc">Get a FunctionLike operation&amp;#39;s body. </div><div class="ttdef"><b>Definition:</b> <a href="FunctionSupport_8cpp_source.html#l00130">FunctionSupport.cpp:130</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_aa5ec71d27d9b622e5ff8205c3546701c"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#aa5ec71d27d9b622e5ff8205c3546701c">mlir::ConversionPatternRewriter::cancelRootUpdate</a></div><div class="ttdeci">void cancelRootUpdate(Operation *op) override</div><div class="ttdoc">PatternRewriter hook for updating the root operation in-place. </div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01454">DialectConversion.cpp:1454</a></div></div>
<div class="ttc" id="classmlir_1_1OpBuilder_html"><div class="ttname"><a href="classmlir_1_1OpBuilder.html">mlir::OpBuilder</a></div><div class="ttdoc">This class helps build Operations. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2Builders_8h_source.html#l00179">Builders.h:179</a></div></div>
<div class="ttc" id="classmlir_1_1ValueRange_html"><div class="ttname"><a href="classmlir_1_1ValueRange.html">mlir::ValueRange</a></div><div class="ttdoc">This class provides an abstraction over the different types of ranges over Values. </div><div class="ttdef"><b>Definition:</b> <a href="OperationSupport_8h_source.html#l00790">OperationSupport.h:790</a></div></div>
<div class="ttc" id="classmlir_1_1ConversionPatternRewriter_html_a9e1921b68c1d495283d400ca68179a59"><div class="ttname"><a href="classmlir_1_1ConversionPatternRewriter.html#a9e1921b68c1d495283d400ca68179a59">mlir::ConversionPatternRewriter::convertNonEntryRegionTypes</a></div><div class="ttdeci">LogicalResult convertNonEntryRegionTypes(Region *region, TypeConverter &amp;converter)</div><div class="ttdoc">Convert the types of block arguments within the given region except for the entry region...</div><div class="ttdef"><b>Definition:</b> <a href="DialectConversion_8cpp_source.html#l01353">DialectConversion.cpp:1353</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html_a3f9cef382c6df9c30afceef254e5c1a5"><div class="ttname"><a href="classmlir_1_1Block.html#a3f9cef382c6df9c30afceef254e5c1a5">mlir::Block::splitBlock</a></div><div class="ttdeci">Block * splitBlock(iterator splitBefore)</div><div class="ttdoc">Split the block into two blocks before the specified operation or iterator. </div><div class="ttdef"><b>Definition:</b> <a href="Block_8cpp_source.html#l00284">Block.cpp:284</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 8 2021 12:36:27 for MLIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
